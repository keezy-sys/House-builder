<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hausplaner</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="auth-screen" class="auth-screen" hidden>
      <div class="auth-card">
        <h2>Willkommen zur√ºck</h2>
        <p class="helper">
          Bitte anmelden, um den Hausplan gemeinsam zu bearbeiten.
        </p>
        <div class="auth-forms" id="auth-forms">
          <form id="login-form" class="auth-form">
            <h3>Anmelden</h3>
            <label>
              E-Mail
              <input type="email" name="email" required autocomplete="email" />
            </label>
            <label>
              Passwort
              <input
                type="password"
                name="password"
                required
                autocomplete="current-password"
              />
            </label>
            <button class="primary" type="submit">Anmelden</button>
            <div class="auth-secondary">
              <button class="link-button" type="button" id="magic-link-btn">
                Magic Link senden
              </button>
              <button class="link-button" type="button" id="reset-password-btn">
                Passwort vergessen?
              </button>
            </div>
          </form>
          <div class="auth-divider"><span>oder</span></div>
          <form id="signup-form" class="auth-form">
            <h3>Neues Konto</h3>
            <label>
              Name
              <input type="text" name="name" required autocomplete="name" />
            </label>
            <label>
              E-Mail
              <input type="email" name="email" required autocomplete="email" />
            </label>
            <label>
              Passwort
              <input
                type="password"
                name="password"
                required
                autocomplete="new-password"
              />
            </label>
            <button type="submit">Konto anlegen</button>
          </form>
        </div>
        <div id="password-reset-panel" class="auth-recovery" hidden>
          <h3>Passwort neu setzen</h3>
          <p class="helper">Bitte ein neues Passwort festlegen.</p>
          <form id="password-reset-form" class="auth-form">
            <label>
              Neues Passwort
              <input
                type="password"
                name="password"
                required
                autocomplete="new-password"
              />
            </label>
            <label>
              Passwort best√§tigen
              <input
                type="password"
                name="passwordConfirm"
                required
                autocomplete="new-password"
              />
            </label>
            <button class="primary" type="submit">Passwort √§ndern</button>
          </form>
        </div>
        <p id="auth-error" class="helper" role="alert"></p>
      </div>
    </div>

    <header class="app-header">
      <div>
        <h1>Hausplaner</h1>
      </div>
      <div class="header-actions">
        <label class="toggle" id="architect-toggle-label">
          <input type="checkbox" id="toggle-architect" />
          <span>Planungsmodus</span>
        </label>
        <button
          type="button"
          id="activity-notification"
          class="activity-notification"
          hidden
        >
          <span>Neue Updates</span>
          <span
            id="activity-notification-count"
            class="activity-notification-count"
            >0</span
          >
        </button>
        <button
          id="help-button"
          class="help-button"
          type="button"
          aria-label="Hilfe √∂ffnen"
          title="Hilfe"
        >
          ?
        </button>
        <div class="auth-info" id="auth-info" hidden>
          <button
            id="user-menu-trigger"
            class="user-menu-trigger"
            type="button"
            aria-haspopup="menu"
            aria-expanded="false"
            aria-controls="user-menu"
          >
            <span id="auth-user-name" class="user-name"></span>
            <span class="user-menu-caret">‚ñæ</span>
          </button>
          <div id="user-menu" class="user-menu" role="menu" hidden>
            <button id="email-accounts-button" type="button" role="menuitem">
              E-Mail
            </button>
            <button id="security-settings" type="button" role="menuitem">
              Sicherheit
            </button>
            <button id="sign-out" type="button" role="menuitem">
              Abmelden
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="app">
      <nav class="mobile-bar" aria-label="Mobile Navigation">
        <label class="mobile-room-picker">
          <span>Raum</span>
          <select id="mobile-room-select" aria-label="Raum ausw√§hlen"></select>
        </label>
        <div
          class="segmented-control mobile-view-toggle"
          role="tablist"
          aria-label="Ansicht w√§hlen"
        >
          <button
            class="segmented-option is-active"
            type="button"
            data-app-view="room"
            id="mobile-view-room"
          >
            Raum
          </button>
          <button
            class="segmented-option"
            type="button"
            data-app-view="tasks"
            id="mobile-view-tasks"
          >
            Aufgaben
          </button>
        </div>
      </nav>
      <section class="floorplan" aria-label="Grundriss">
        <div class="floorplan-header">
          <div class="floorplan-copy">
            <h2>2D-Grundriss</h2>
            <p id="floorplan-hint">
              Bewegen Sie die Maus √ºber einen Raum, um ihn hervorzuheben.
            </p>
          </div>
          <div class="floor-switch">
            <span class="floor-switch-label">Etage</span>
            <div class="floor-switch-control">
              <span>EG</span>
              <input
                type="range"
                id="floor-toggle"
                min="0"
                max="1"
                step="1"
                value="1"
                aria-label="Etage wechseln"
              />
              <span>OG</span>
            </div>
            <span id="floor-label" class="floor-switch-value"
              >Obergeschoss</span
            >
          </div>
        </div>
        <div class="floorplan-wrapper" id="floorplan-wrapper">
          <svg
            id="floorplan"
            viewBox="0 0 800 520"
            role="img"
            aria-labelledby="floorplan-title"
          >
            <title id="floorplan-title">Interaktiver Grundriss</title>
          </svg>
          <div
            id="comment-tooltip"
            class="comment-tooltip"
            role="status"
            aria-hidden="true"
            hidden
          >
            <div
              id="comment-tooltip-author"
              class="comment-tooltip-author user-name"
            ></div>
            <div id="comment-tooltip-text" class="comment-tooltip-text"></div>
          </div>
        </div>
        <div class="floorplan-actions">
          <button id="clear-selection" type="button">Auswahl l√∂schen</button>
        </div>
      </section>

      <aside class="sidebar" aria-label="Raumdetails">
        <section class="panel view-toggle" data-architect-hidden>
          <div class="panel-header">
            <h3>Ansicht</h3>
          </div>
          <div
            class="segmented-control"
            role="tablist"
            aria-label="Ansicht w√§hlen"
          >
            <button
              class="segmented-option is-active"
              type="button"
              data-app-view="room"
              id="view-room"
            >
              Raum
            </button>
            <button
              class="segmented-option"
              type="button"
              data-app-view="tasks"
              id="view-tasks"
            >
              Aufgaben
            </button>
          </div>
        </section>

        <div class="view-stack is-active" id="room-view" data-architect-hidden>
          <section class="panel" id="room-panel">
            <div class="room-title-row">
              <h2 id="room-title">Bitte w√§hlen Sie einen Raum</h2>
              <button
                id="room-chat-trigger"
                class="chat-trigger"
                type="button"
                aria-label="ChatGPT Chat"
                title="ChatGPT Chat"
                aria-disabled="true"
                disabled
              ></button>
            </div>
            <p id="room-subtitle">
              Klicken Sie auf einen Raum im Grundriss, um Details zu sehen.
            </p>
            <div class="room-tabs" role="tablist" aria-label="Raumdetails">
              <button
                class="room-tab is-active"
                type="button"
                data-room-tab="overview"
                aria-selected="true"
              >
                √úbersicht
              </button>
              <button
                class="room-tab"
                type="button"
                data-room-tab="tasks"
                aria-selected="false"
              >
                Aufgaben
              </button>
              <button
                class="room-tab"
                type="button"
                data-room-tab="inspiration"
                aria-selected="false"
              >
                Inspiration
              </button>
              <button
                class="room-tab"
                type="button"
                data-room-tab="decisions"
                aria-selected="false"
              >
                Entscheidungen
              </button>
            </div>
          </section>

          <section class="panel" id="room-tasks-panel" data-room-panel="tasks">
            <h3>Aufgaben</h3>
            <ul id="room-tasks" class="task-list"></ul>
            <p id="room-tasks-empty" class="helper" hidden>
              Noch keine Aufgaben f√ºr diesen Raum.
            </p>
            <form id="task-form" class="form-row">
              <input
                type="text"
                id="task-input"
                placeholder="Aufgabe hinzuf√ºgen, z.B. Fliesen bestellen #material #geraete"
              />
              <button type="submit" class="primary">Hinzuf√ºgen</button>
            </form>
            <p class="helper">Hashtags werden als Tags √ºbernommen.</p>
          </section>

          <section class="panel" data-room-panel="inspiration">
            <h3>Inspirationen &amp; Referenzen</h3>
            <p class="helper">
              Sammeln Sie Bilder, Links und Dateien als Grundlage f√ºr
              Entscheidungen.
            </p>
            <div class="evidence-block">
              <h4>Bilder, Dateien &amp; Links</h4>
              <div id="image-gallery" class="image-gallery"></div>
              <div class="evidence-targets">
                <label>
                  <span>Raum</span>
                  <select id="evidence-room-select"></select>
                </label>
                <label>
                  <span>Aufgabe</span>
                  <select id="evidence-task-select"></select>
                </label>
              </div>
              <div class="button-row">
                <button id="generate-image" class="primary" type="button">
                  Mit ChatGPT erzeugen
                </button>
                <label class="upload-btn">
                  Datei hochladen
                  <input
                    type="file"
                    id="upload-image"
                    accept="image/*,application/pdf"
                  />
                </label>
                <button id="add-evidence-link" type="button">
                  Link hinzuf√ºgen
                </button>
                <button id="set-api-key" type="button">
                  API-Schl√ºssel setzen
                </button>
              </div>
              <p id="image-status" class="helper"></p>
              <p class="helper">
                Tipp: mehrere Blickwinkel pro Raum speichern.
              </p>
            </div>
          </section>

          <section
            class="panel three-d-panel"
            id="three-d-panel"
            data-room-panel="inspiration"
          >
            <div class="panel-header">
              <h3>3D-Ansicht</h3>
              <button id="toggle-3d" type="button">√ñffnen</button>
            </div>
            <p id="three-d-label" class="helper">3D-Ansicht f√ºr den Raum</p>
            <div class="three-d-controls">
              <div class="three-d-control">
                <span class="three-d-control-label">Ansicht</span>
                <div
                  class="segmented-control"
                  role="group"
                  aria-label="3D-Ansicht w√§hlen"
                >
                  <button
                    class="segmented-option is-active"
                    type="button"
                    data-view="walkthrough"
                  >
                    Innen (Schnitt)
                  </button>
                  <button
                    class="segmented-option"
                    type="button"
                    data-view="model"
                  >
                    Modell
                  </button>
                </div>
                <span class="three-d-control-hint">
                  Innen: Dach &amp; Frontwand ge√∂ffnet ¬∑ Modell: Au√üenvolumen
                </span>
              </div>
              <button id="three-d-reset" type="button">
                Ansicht zur√ºcksetzen
              </button>
            </div>
            <div class="three-d-viewer">
              <div
                class="three-d-stage"
                id="three-d-stage"
                data-view="walkthrough"
              >
                <div class="three-d-camera" id="three-d-camera">
                  <div class="three-d-room" id="three-d-room"></div>
                </div>
              </div>
              <div class="three-d-hud">
                <span class="three-d-hint">
                  Ziehen: Blick drehen ¬∑ Scrollen: Zoom
                </span>
                <span id="three-d-readout" class="three-d-readout"></span>
              </div>
            </div>
          </section>

          <section class="panel" data-room-panel="decisions">
            <h3>Entscheidungen</h3>
            <p class="helper">
              Halten Sie fest, was beschlossen wurde und warum. Optional mit
              Aufgaben verkn√ºpfen.
            </p>
            <ul id="decision-list" class="decision-list"></ul>
            <form id="decision-form" class="decision-form">
              <label>
                Titel
                <input
                  type="text"
                  id="decision-title"
                  name="decision-title"
                  required
                />
              </label>
              <label>
                Begr√ºndung
                <textarea
                  id="decision-body"
                  name="decision-body"
                  rows="4"
                  required
                ></textarea>
              </label>
              <fieldset class="decision-links">
                <legend>Mit Aufgaben verkn√ºpfen (optional)</legend>
                <div id="decision-tasks" class="decision-task-list"></div>
                <p id="decision-tasks-empty" class="helper"></p>
              </fieldset>
              <button class="primary" type="submit">
                Entscheidung speichern
              </button>
            </form>
          </section>

          <section class="panel" data-room-panel="overview">
            <h3>Kommentare</h3>
            <ul id="comments" class="comments"></ul>
          </section>

          <section class="panel" data-room-panel="overview">
            <h3>Aktivit√§t im Raum</h3>
            <ul id="room-activity" class="activity-list"></ul>
            <p id="room-activity-empty" class="helper"></p>
          </section>
        </div>

        <div class="view-stack" id="tasks-view" data-architect-hidden hidden>
          <section class="panel" id="tasks-panel">
            <div class="panel-header">
              <div class="panel-title">
                <h2>Aufgaben√ºbersicht</h2>
                <p id="task-count" class="helper">0 Aufgaben</p>
              </div>
            </div>
            <form id="task-create-form" class="task-create">
              <label>
                <span>Aufgabe</span>
                <input
                  type="text"
                  id="task-create-input"
                  placeholder="Aufgabe hinzuf√ºgen, z.B. Fliesen bestellen #material"
                />
              </label>
              <label>
                <span>Raum</span>
                <select id="task-create-room"></select>
              </label>
              <button type="submit" class="primary">Neue Aufgabe</button>
            </form>
            <p class="helper task-create-hint">
              Hashtags werden als Tags √ºbernommen.
            </p>
            <details class="task-advanced" id="task-advanced">
              <summary>
                <span>Filter &amp; Ansicht</span>
              </summary>
              <div class="task-advanced-body">
                <div class="task-advanced-actions">
                  <button id="tasks-reset" type="button">
                    Filter zur√ºcksetzen
                  </button>
                </div>
                <div class="task-views">
                  <span class="task-views-label">Ansichten</span>
                  <div
                    class="segmented-control"
                    role="tablist"
                    aria-label="Aufgabenansichten"
                  >
                    <button
                      class="segmented-option is-active"
                      type="button"
                      data-task-view="all"
                      aria-selected="true"
                    >
                      Alle
                    </button>
                    <button
                      class="segmented-option"
                      type="button"
                      data-task-view="materials"
                      aria-selected="false"
                    >
                      Material
                    </button>
                    <button
                      class="segmented-option"
                      type="button"
                      data-task-view="devices"
                      aria-selected="false"
                    >
                      Geraete
                    </button>
                    <button
                      class="segmented-option"
                      type="button"
                      data-task-view="permits"
                      aria-selected="false"
                    >
                      Genehmigungen
                    </button>
                    <button
                      class="segmented-option"
                      type="button"
                      data-task-view="contractors"
                      aria-selected="false"
                    >
                      Handwerker
                    </button>
                  </div>
                </div>
                <div class="task-filters">
                  <label>
                    Raum
                    <select id="task-filter-room"></select>
                  </label>
                  <label>
                    Status
                    <select id="task-filter-status"></select>
                  </label>
                  <label>
                    Zust√§ndig
                    <select id="task-filter-assignee"></select>
                  </label>
                  <label>
                    Tag
                    <select id="task-filter-tag"></select>
                  </label>
                  <label>
                    Suche
                    <input
                      type="search"
                      id="task-filter-search"
                      placeholder="Nach Titel oder Notiz suchen"
                    />
                  </label>
                </div>
                <div class="task-bulk-actions">
                  <label class="task-select-all">
                    <input type="checkbox" id="task-select-all" />
                    <span>Alle ausw√§hlen</span>
                  </label>
                  <span id="task-selection-count" class="helper"
                    >Keine Auswahl</span
                  >
                  <div class="task-bulk-row">
                    <button id="task-bulk-done" type="button" disabled>
                      Erledigt markieren
                    </button>
                    <div class="task-bulk-field">
                      <select id="task-bulk-assignee"></select>
                      <button id="task-bulk-assign" type="button" disabled>
                        Zuweisen
                      </button>
                    </div>
                    <div class="task-bulk-field">
                      <input type="date" id="task-bulk-due" />
                      <button id="task-bulk-due-apply" type="button" disabled>
                        F√§llig setzen
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </details>
            <div class="tasks-layout">
              <div class="tasks-board">
                <div class="task-board-scroll">
                  <section
                    id="task-list"
                    class="task-board"
                    aria-label="Aufgaben nach Status"
                  ></section>
                </div>
                <p id="tasks-empty" class="helper" hidden>
                  Keine Aufgaben f√ºr diese Filter.
                </p>
              </div>
              <div class="gantt-panel">
                <div class="gantt-panel-header">
                  <div>
                    <h3>Kalender</h3>
                    <p class="helper">
                      Abh√§ngigkeiten per Drag &amp; Drop zwischen Aufgaben
                      verbinden.
                    </p>
                  </div>
                  <div id="gantt-range" class="gantt-range"></div>
                </div>
                <div id="gantt-chart" class="gantt-chart"></div>
              </div>
            </div>
          </section>
        </div>

        <section id="architect-view" class="architect-view" hidden>
          <section class="panel architect-panel">
            <div class="panel-header">
              <h3>Modus</h3>
            </div>
            <div
              class="segmented-control"
              role="tablist"
              aria-label="Modus w√§hlen"
            >
              <button
                class="segmented-option is-active"
                type="button"
                data-planner-mode="architect"
                aria-selected="true"
              >
                Architekten
              </button>
              <button
                class="segmented-option"
                type="button"
                data-planner-mode="interior"
                aria-selected="false"
              >
                Innenarchitekt
              </button>
            </div>
            <p id="planner-mode-hint" class="helper"></p>
            <label class="toggle architect-toggle">
              <input type="checkbox" id="toggle-exterior" />
              <span>Au√üenbereiche anzeigen</span>
            </label>
          </section>

          <section class="panel architect-panel" data-planner-panel="architect">
            <div class="panel-header">
              <h3>Architektur</h3>
            </div>
            <div class="architect-tools">
              <span class="architect-tools-label">Werkzeuge</span>
              <div
                class="segmented-control"
                role="tablist"
                aria-label="Werkzeug w√§hlen"
              >
                <button
                  class="segmented-option is-active"
                  type="button"
                  data-architect-tool="select"
                  aria-selected="true"
                >
                  Auswahl
                </button>
                <button
                  class="segmented-option"
                  type="button"
                  data-architect-tool="door"
                  aria-selected="false"
                >
                  T√ºr
                </button>
                <button
                  class="segmented-option"
                  type="button"
                  data-architect-tool="window"
                  aria-selected="false"
                >
                  Fenster
                </button>
                <button
                  class="segmented-option"
                  type="button"
                  data-architect-tool="room"
                  aria-selected="false"
                >
                  Raum
                </button>
              </div>
              <p id="architect-tool-hint" class="helper"></p>
            </div>
          </section>

          <section class="panel architect-panel" data-planner-panel="architect">
            <h3 id="architect-title">Element w√§hlen</h3>
            <form id="measurement-form" class="measurement-form" hidden>
              <div
                class="measurement-group"
                role="group"
                aria-labelledby="measure-axis-label"
              >
                <span id="measure-axis-label" class="measurement-label">
                  X-Position der Wand (mm)
                </span>
                <div class="measurement-row">
                  <input
                    type="range"
                    id="measure-axis"
                    min="0"
                    max="10000"
                    aria-labelledby="measure-axis-label"
                  />
                  <input
                    type="number"
                    id="measure-axis-number"
                    min="0"
                    max="10000"
                    step="20"
                    required
                    aria-labelledby="measure-axis-label"
                  />
                </div>
              </div>
              <div
                class="measurement-group"
                role="group"
                aria-labelledby="measure-span-label"
              >
                <span id="measure-span-label" class="measurement-label">
                  Y-L√§nge der Wand (mm)
                </span>
                <div class="measurement-row">
                  <input
                    type="range"
                    id="measure-span"
                    min="0"
                    max="10000"
                    aria-labelledby="measure-span-label"
                  />
                  <input
                    type="number"
                    id="measure-span-number"
                    min="0"
                    max="10000"
                    step="20"
                    required
                    aria-labelledby="measure-span-label"
                  />
                </div>
              </div>
              <div
                id="measure-height-row"
                class="measurement-group"
                role="group"
                aria-labelledby="measure-height-label"
              >
                <span id="measure-height-label" class="measurement-label">
                  √ñffnungsh√∂he (mm)
                </span>
                <div class="measurement-row">
                  <input
                    type="range"
                    id="measure-height"
                    min="0"
                    max="3000"
                    aria-labelledby="measure-height-label"
                  />
                  <input
                    type="number"
                    id="measure-height-number"
                    min="0"
                    max="3000"
                    step="10"
                    required
                    aria-labelledby="measure-height-label"
                  />
                </div>
              </div>
              <label id="measure-swing-row" class="measurement-toggle">
                <input type="checkbox" id="measure-swing" />
                Schwenkbogen anzeigen
              </label>
              <label id="measure-lock-row" class="measurement-toggle">
                <input type="checkbox" id="measure-lock" checked />
                Angrenzende R√§ume koppeln
              </label>
              <p id="measure-note" class="helper">Wandh√∂he fix: 2800 mm.</p>
              <button type="submit" class="visually-hidden">
                Werte √ºbernehmen
              </button>
            </form>
            <p id="architect-help" class="helper"></p>
          </section>

          <section class="panel architect-panel" data-planner-panel="interior">
            <div class="panel-header">
              <h3>Innenobjekte</h3>
            </div>
            <div class="architect-tools interior-tools">
              <span class="architect-tools-label">Einf√ºgen</span>
              <div
                class="segmented-control"
                role="group"
                aria-label="Objekt einf√ºgen"
              >
                <button
                  class="segmented-option"
                  type="button"
                  data-interior-insert="rect"
                >
                  Rechteck
                </button>
                <button
                  class="segmented-option"
                  type="button"
                  data-interior-insert="circle"
                >
                  Kreis
                </button>
              </div>
              <p id="interior-tool-hint" class="helper"></p>
            </div>
          </section>

          <section class="panel architect-panel" data-planner-panel="interior">
            <h3 id="interior-title">Objekt w√§hlen</h3>
            <form id="object-form" class="object-form" hidden>
              <label class="object-group">
                <span class="object-label">Name</span>
                <input type="text" id="object-name" />
              </label>
              <div class="object-grid">
                <label class="object-group">
                  <span class="object-label">X (Mitte)</span>
                  <input
                    type="number"
                    id="object-x"
                    inputmode="decimal"
                    step="1"
                  />
                </label>
                <label class="object-group">
                  <span class="object-label">Y (Mitte)</span>
                  <input
                    type="number"
                    id="object-y"
                    inputmode="decimal"
                    step="1"
                  />
                </label>
                <label class="object-group">
                  <span class="object-label">Breite</span>
                  <input
                    type="number"
                    id="object-width"
                    inputmode="decimal"
                    step="1"
                    min="24"
                  />
                </label>
                <label class="object-group">
                  <span class="object-label">H√∂he</span>
                  <input
                    type="number"
                    id="object-height"
                    inputmode="decimal"
                    step="1"
                    min="24"
                  />
                </label>
                <label class="object-group">
                  <span class="object-label">Rotation (Grad)</span>
                  <input
                    type="number"
                    id="object-rotation"
                    inputmode="decimal"
                    step="0.1"
                  />
                </label>
              </div>
              <button type="submit" class="visually-hidden">
                Werte √ºbernehmen
              </button>
            </form>
            <p id="interior-help" class="helper"></p>
          </section>
        </section>
      </aside>
    </main>

    <details
      id="activity-page"
      class="activity-page"
      aria-label="Aktivit√§tsfeed"
    >
      <summary class="activity-toggle">
        <span class="activity-header">
          <span class="activity-title">Aktivit√§tsfeed</span>
          <span class="helper">
            Letzte Ereignisse aus Aufgaben, Kommentaren, Dateien und
            Entscheidungen.
          </span>
        </span>
      </summary>
      <div class="activity-body">
        <ul id="activity-feed" class="activity-list"></ul>
        <p id="activity-empty" class="helper">
          Noch keine Aktivit√§t vorhanden.
        </p>
      </div>
    </details>

    <div id="task-modal" class="modal" hidden>
      <div
        class="modal-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="task-modal-title"
      >
        <div class="modal-header">
          <h3 id="task-modal-title">Aufgabe planen</h3>
          <div class="modal-header-actions">
            <button
              type="button"
              id="task-modal-chat"
              class="chat-trigger"
              aria-label="ChatGPT Chat zur Aufgabe"
              title="ChatGPT Chat zur Aufgabe"
            ></button>
            <button type="button" id="task-modal-close">Schlie√üen</button>
          </div>
        </div>
        <form id="task-modal-form" class="modal-form">
          <details class="task-date-panel" id="task-date-panel">
            <summary>
              <span id="task-date-summary">Termin hinzuf√ºgen</span>
            </summary>
            <div class="task-date-fields">
              <label>
                Startdatum
                <input type="date" id="task-start-date" />
              </label>
              <label>
                Enddatum
                <input type="date" id="task-end-date" />
              </label>
            </div>
          </details>
          <div class="dependency-panel">
            <div class="dependency-header">
              <div class="dependency-title">Abh√§ngigkeiten</div>
              <button
                type="button"
                id="task-dependency-toggle"
                aria-haspopup="dialog"
                aria-expanded="false"
                aria-controls="task-dependency-picker"
              >
                Ausw√§hlen
              </button>
            </div>
            <p id="task-dependency-summary" class="helper"></p>
            <div id="task-dependency-picker" class="dependency-picker" hidden>
              <div class="dependency-picker-header">
                <span>Aufgaben verkn√ºpfen</span>
                <button type="button" id="task-dependency-close">
                  Schlie√üen
                </button>
              </div>
              <div class="dependency-legend">
                <span class="dependency-legend-item"
                  >-&gt; Diese Aufgabe h√§ngt von der Auswahl ab</span
                >
                <span class="dependency-legend-item"
                  >&lt;- Auswahl h√§ngt von dieser Aufgabe ab</span
                >
              </div>
              <div id="task-dependency-list" class="dependency-list"></div>
            </div>
          </div>
          <div class="task-file-panel">
            <div class="task-file-header">
              <div class="task-file-title">Dateien &amp; Links</div>
              <div class="task-file-actions">
                <label class="upload-btn">
                  Datei hochladen
                  <input
                    type="file"
                    id="task-file-upload"
                    accept="image/*,application/pdf"
                  />
                </label>
                <button type="button" id="task-file-link">
                  Link hinzuf√ºgen
                </button>
              </div>
            </div>
            <div id="task-file-list" class="image-gallery task-file-list"></div>
            <p id="task-file-empty" class="helper" hidden>
              Keine Dateien f√ºr diese Aufgabe.
            </p>
          </div>
          <div class="task-email-panel" id="task-email-panel">
            <div class="task-email-header">
              <div class="task-email-title">E-Mail-Threads</div>
              <div class="task-email-actions">
                <button type="button" id="email-panel-refresh">
                  Aktualisieren
                </button>
                <button
                  type="button"
                  id="email-unlinked-toggle"
                  aria-expanded="false"
                  aria-controls="email-unlinked-panel"
                >
                  + Thread verkn√ºpfen
                </button>
              </div>
            </div>
            <p id="email-panel-status" class="helper" hidden></p>
            <div class="email-section">
              <div class="email-section-title">
                Mit dieser Aufgabe verkn√ºpft
              </div>
              <ul id="email-linked-threads" class="email-thread-list"></ul>
            </div>
            <div
              class="email-section email-unlinked-panel"
              id="email-unlinked-panel"
              hidden
            >
              <div class="email-section-title">Weitere Threads</div>
              <p class="helper">
                Nur E-Mails im Ordner/Label ‚ÄûLugano‚Äú erscheinen hier.
              </p>
              <ul id="email-unlinked-threads" class="email-thread-list"></ul>
            </div>
            <div id="email-thread-view" class="email-thread-view" hidden>
              <div id="email-thread-meta" class="email-thread-meta"></div>
              <ul id="email-thread-messages" class="email-thread-messages"></ul>
              <div class="email-reply">
                <div class="email-reply-header">
                  <span>Antwort</span>
                  <div class="email-reply-header-actions">
                    <button type="button" id="email-reply-translate">
                      üáÆüáπ √úbersetzen
                    </button>
                    <span
                      id="email-reply-translate-status"
                      class="helper"
                      hidden
                    ></span>
                  </div>
                </div>
                <div
                  id="email-reply-translation"
                  class="email-reply-translation"
                  hidden
                >
                  <label class="email-reply-translation-field">
                    <span>√úbersetzung (Italienisch)</span>
                    <textarea
                      id="email-reply-text-it"
                      rows="3"
                      placeholder="√úbersetzung auf Italienisch"
                    ></textarea>
                  </label>
                  <p class="helper">Diese Version wird gesendet.</p>
                </div>
                <label class="email-reply-original">
                  <span>Original (Deutsch)</span>
                  <textarea
                    id="email-reply-text"
                    rows="3"
                    placeholder="Antwort schreiben"
                  ></textarea>
                </label>
              </div>
              <div class="email-reply-actions">
                <button type="button" id="email-reply-send" class="primary">
                  Antwort senden
                </button>
                <span id="email-reply-status" class="helper"></span>
              </div>
            </div>
          </div>
          <div class="modal-actions">
            <button
              type="button"
              id="task-modal-delete"
              class="image-delete task-modal-delete"
            >
              Aufgabe l√∂schen
            </button>
            <button type="button" id="task-modal-cancel">Abbrechen</button>
            <button type="submit" class="primary">Speichern</button>
          </div>
        </form>
      </div>
    </div>

    <div id="email-accounts-modal" class="modal" hidden>
      <div
        class="modal-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="email-accounts-title"
      >
        <div class="modal-header">
          <h3 id="email-accounts-title">E-Mail-Konten</h3>
          <button type="button" id="email-accounts-close">Schlie√üen</button>
        </div>
        <div class="email-accounts-panel">
          <p id="email-accounts-status" class="helper" hidden></p>
          <div class="email-accounts-toolbar">
            <button type="button" id="email-accounts-refresh">
              Aktualisieren
            </button>
          </div>
          <div class="email-accounts" id="email-accounts"></div>
          <div class="email-connect-actions" id="email-connect-actions">
            <button id="email-connect-gmail" type="button">
              Gmail verbinden
            </button>
            <button id="email-connect-microsoft" type="button">
              Outlook verbinden
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="security-modal" class="modal" hidden>
      <div
        class="modal-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="security-modal-title"
      >
        <div class="modal-header">
          <h3 id="security-modal-title">Sicherheit</h3>
          <button type="button" id="security-modal-close">Schlie√üen</button>
        </div>
        <div class="security-panel">
          <section class="security-section">
            <h4>Zwei-Faktor-Authentifizierung</h4>
            <p id="security-2fa-status" class="helper"></p>
            <div id="security-2fa-actions" class="security-actions">
              <button id="security-2fa-start" type="button" class="primary">
                2FA einrichten
              </button>
              <button id="security-2fa-disable" type="button">
                2FA deaktivieren
              </button>
            </div>
            <div id="security-2fa-setup" class="security-setup" hidden>
              <div class="security-qr">
                <img
                  id="security-qr-image"
                  alt="QR-Code f√ºr 2FA"
                  src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
                />
                <div id="security-secret" class="security-secret"></div>
              </div>
              <label>
                Code best√§tigen
                <input
                  id="security-2fa-code"
                  type="text"
                  inputmode="numeric"
                  autocomplete="one-time-code"
                />
              </label>
              <button id="security-2fa-confirm" type="button" class="primary">
                2FA aktivieren
              </button>
              <div
                id="security-recovery-codes"
                class="security-recovery"
                hidden
              >
                <div class="security-recovery-title">Recovery-Codes</div>
                <ul
                  id="security-recovery-list"
                  class="security-recovery-list"
                ></ul>
                <p class="helper">
                  Codes sicher speichern. Jeder Code funktioniert nur einmal.
                </p>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>

    <div id="reauth-modal" class="modal" hidden>
      <div
        class="modal-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="reauth-modal-title"
      >
        <div class="modal-header">
          <h3 id="reauth-modal-title">Best√§tigung erforderlich</h3>
          <button type="button" id="reauth-modal-close">Schlie√üen</button>
        </div>
        <p id="reauth-helper" class="helper"></p>
        <form id="reauth-form" class="modal-form">
          <label id="reauth-code-row" hidden>
            TOTP-Code
            <input
              id="reauth-code"
              type="text"
              inputmode="numeric"
              autocomplete="one-time-code"
            />
          </label>
          <label id="reauth-recovery-row" hidden>
            Recovery-Code
            <input id="reauth-recovery" type="text" />
          </label>
          <label id="reauth-password-row" hidden>
            Passwort
            <input
              id="reauth-password"
              type="password"
              autocomplete="current-password"
            />
          </label>
          <button type="submit" class="primary">Best√§tigen</button>
        </form>
        <p id="reauth-status" class="helper" role="alert"></p>
      </div>
    </div>

    <div id="chat-modal" class="modal" hidden>
      <div
        class="modal-surface chat-modal-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="chat-modal-title"
      >
        <div class="modal-header">
          <div class="chat-modal-heading">
            <h3 id="chat-modal-title">ChatGPT Chat</h3>
            <p id="chat-modal-context" class="helper"></p>
          </div>
          <button type="button" id="chat-modal-close">Schlie√üen</button>
        </div>
        <ul id="chat-thread" class="chat-thread"></ul>
        <p id="chat-status" class="helper"></p>
        <form id="chat-form" class="chat-form">
          <div class="chat-input-row">
            <textarea
              id="chat-input"
              rows="3"
              placeholder="Nachricht eingeben"
              aria-label="Nachricht"
            ></textarea>
            <button type="submit" class="primary">Senden</button>
          </div>
        </form>
      </div>
    </div>

    <div id="image-modal" class="modal" hidden>
      <div
        class="modal-surface image-modal-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="image-modal-title"
      >
        <div class="modal-header">
          <h3 id="image-modal-title">Bild bearbeiten</h3>
          <button type="button" id="image-modal-close">Schlie√üen</button>
        </div>
        <div class="image-modal-body">
          <div class="image-modal-preview">
            <div class="image-preview-frame">
              <img
                id="image-modal-preview"
                alt=""
                src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
              />
              <canvas id="image-mask-canvas" class="image-mask" hidden></canvas>
            </div>
            <div class="image-mask-tools">
              <button type="button" id="image-mask-toggle">
                Bereich markieren
              </button>
              <label class="image-mask-size">
                <span>Pinsel</span>
                <input
                  type="range"
                  id="image-mask-size"
                  min="6"
                  max="80"
                  value="28"
                />
              </label>
              <button type="button" id="image-mask-clear">Maske l√∂schen</button>
            </div>
            <p class="helper image-mask-hint">
              Transparente Bereiche werden ver√§ndert.
            </p>
          </div>
          <div class="image-modal-sidebar">
            <div id="image-modal-meta" class="image-modal-meta"></div>
            <form id="image-edit-form" class="image-edit-form">
              <label>
                Neue Anweisung
                <textarea
                  id="image-edit-prompt"
                  rows="3"
                  placeholder="z.B. neue Farben, anderes Licht, Detail √§ndern"
                ></textarea>
              </label>
              <button type="submit" class="primary">√Ñnderung erzeugen</button>
              <p id="image-edit-status" class="helper"></p>
            </form>
            <div class="image-pin-panel">
              <label>
                Pin an Fl√§che
                <select id="image-pin-surface">
                  <option value="">Nicht angeheftet</option>
                  <option value="wall-north">Wand Nord</option>
                  <option value="wall-south">Wand S√ºd</option>
                  <option value="wall-east">Wand Ost</option>
                  <option value="wall-west">Wand West</option>
                  <option value="floor">Boden</option>
                  <option value="ceiling">Decke</option>
                </select>
              </label>
              <div class="image-pin-actions">
                <button type="button" id="image-pin-apply">Anheften</button>
                <button type="button" id="image-pin-clear">Pin l√∂sen</button>
              </div>
            </div>
            <div class="image-thread">
              <h4>Verlauf</h4>
              <ul id="image-thread-list" class="image-thread-list"></ul>
            </div>
            <button type="button" id="image-delete" class="image-delete">
              Bild l√∂schen
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="help-modal" class="modal" hidden>
      <div
        class="modal-surface help-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="help-modal-title"
      >
        <div class="modal-header">
          <h3 id="help-modal-title">Hilfe &amp; Schnellstart</h3>
          <button type="button" id="help-modal-close">Schlie√üen</button>
        </div>
        <div class="help-content">
          <p class="helper">
            Kurz erkl√§rt: Die wichtigsten Bereiche der App in Klartext.
          </p>
          <div class="help-grid">
            <section class="help-card">
              <h4>Ansicht &amp; Navigation</h4>
              <p>
                Etage oben rechts wechseln. Im Block "Ansicht" zwischen Raum und
                Aufgaben√ºbersicht umschalten.
              </p>
            </section>
            <section class="help-card">
              <h4>Raumdetails</h4>
              <p>
                Raum im Grundriss anklicken, dann Tabs nutzen: √úbersicht
                (Kommentare, Aktivit√§t), Aufgaben (raumbezogen), Inspiration
                (Bilder, Links, Dateien) und Entscheidungen.
              </p>
            </section>
            <section class="help-card">
              <h4>Aufgaben√ºbersicht</h4>
              <p>
                Alle Aufgaben mit Filtern, Suche und Mehrfachauswahl. Bulk:
                Erledigt, Zuweisen, F√§llig. Timeline zeigt Termine.
              </p>
            </section>
            <section class="help-card">
              <h4>Inspiration</h4>
              <p>
                Bilder hochladen oder per ChatGPT erzeugen, Links und Dateien
                sammeln, um Referenzen f√ºr den Raum zu sichern.
              </p>
            </section>
            <section class="help-card">
              <h4>Entscheidungen</h4>
              <p>
                Beschl√ºsse dokumentieren, begr√ºnden und optional mit Aufgaben
                verkn√ºpfen, damit nachvollziehbar bleibt, warum etwas gew√§hlt
                wurde.
              </p>
            </section>
            <section class="help-card">
              <h4>3D-Ansicht</h4>
              <p>
                Im Raum-Panel √∂ffnen. Innen/Modell w√§hlen, Stil, Material und
                Licht anpassen, Ansicht zur√ºcksetzen.
              </p>
            </section>
            <section class="help-card">
              <h4>Architekt-Ansicht</h4>
              <p>
                Oben aktivieren. Rechts Werkzeuge f√ºr Auswahl, T√ºr/Fenster und
                Raum-Zeichnung; Ma√üe direkt eingeben. Au√üenbereiche per Toggle
                anzeigen.
              </p>
            </section>
            <section class="help-card">
              <h4>Aktivit√§t</h4>
              <p>
                Der Aktivit√§tsfeed unten b√ºndelt neue Aufgaben, Kommentare,
                Dateien und Entscheidungen.
              </p>
            </section>
          </div>
          <section class="help-chat-config">
            <h4>ChatGPT-Standard</h4>
            <p class="helper">
              Aktuelles Modell und Reasoning-Aufwand werden serverseitig
              verwaltet.
            </p>
            <div class="help-chat-values">
              <span id="chat-config-model">Modell: ‚Äì</span>
              <span id="chat-config-effort">Reasoning-Aufwand: ‚Äì</span>
            </div>
          </section>
        </div>
      </div>
    </div>

    <div
      id="comment-context-menu"
      class="comment-context-menu"
      role="menu"
      aria-label="Kommentaraktionen"
      aria-hidden="true"
      hidden
    >
      <button type="button" data-action="edit">Kommentar bearbeiten</button>
      <button type="button" data-action="resolve">
        Als erledigt markieren
      </button>
      <button type="button" class="danger" data-action="delete">
        Kommentar l√∂schen
      </button>
    </div>

    <div
      id="task-plan-menu"
      class="task-plan-menu"
      role="menu"
      aria-label="Planen"
      aria-hidden="true"
      hidden
    >
      <button type="button" data-action="plan">Aufgabe planen</button>
      <button type="button" data-action="chat">ChatGPT Chat zur Aufgabe</button>
    </div>

    <script src="config.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
