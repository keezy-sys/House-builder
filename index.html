<!doctype html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hausplaner</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="auth-screen" class="auth-screen" hidden>
      <div class="auth-card">
        <h2>Willkommen zurück</h2>
        <p class="helper">
          Bitte anmelden, um den Hausplan gemeinsam zu bearbeiten.
        </p>
        <div class="auth-forms">
          <form id="login-form" class="auth-form">
            <h3>Anmelden</h3>
            <label>
              E-Mail
              <input type="email" name="email" required autocomplete="email" />
            </label>
            <label>
              Passwort
              <input
                type="password"
                name="password"
                required
                autocomplete="current-password"
              />
            </label>
            <button class="primary" type="submit">Anmelden</button>
          </form>
          <div class="auth-divider"><span>oder</span></div>
          <form id="signup-form" class="auth-form">
            <h3>Neues Konto</h3>
            <label>
              Name
              <input type="text" name="name" required autocomplete="name" />
            </label>
            <label>
              E-Mail
              <input type="email" name="email" required autocomplete="email" />
            </label>
            <label>
              Passwort
              <input
                type="password"
                name="password"
                required
                autocomplete="new-password"
              />
            </label>
            <button type="submit">Konto anlegen</button>
          </form>
        </div>
        <p id="auth-error" class="helper" role="alert"></p>
      </div>
    </div>

    <header class="app-header">
      <div>
        <h1>Hausplaner</h1>
        <p class="subtitle">
          Einfacher Grundriss, klare Aufgaben und gute Zusammenarbeit.
        </p>
      </div>
      <div class="header-actions">
        <label class="toggle">
          <input type="checkbox" id="toggle-architect" />
          <span>Architekt-Ansicht</span>
        </label>
        <button
          id="help-button"
          class="help-button"
          type="button"
          aria-label="Hilfe öffnen"
          title="Hilfe"
        >
          ?
        </button>
        <div class="auth-info" id="auth-info" hidden>
          <div class="auth-user">
            <span class="auth-label">Angemeldet als</span>
            <span id="auth-user-name"></span>
          </div>
          <button id="sign-out" type="button">Abmelden</button>
        </div>
      </div>
    </header>

    <main class="app">
      <section class="floorplan" aria-label="Grundriss">
        <div class="floorplan-header">
          <div class="floorplan-copy">
            <h2>2D-Grundriss</h2>
            <p id="floorplan-hint">
              Bewegen Sie die Maus über einen Raum, um ihn hervorzuheben.
            </p>
          </div>
          <div class="floor-switch">
            <span class="floor-switch-label">Etage</span>
            <div class="floor-switch-control">
              <span>EG</span>
              <input
                type="range"
                id="floor-toggle"
                min="0"
                max="1"
                step="1"
                value="0"
                aria-label="Etage wechseln"
              />
              <span>OG</span>
            </div>
            <span id="floor-label" class="floor-switch-value">Erdgeschoss</span>
          </div>
        </div>
        <div class="floorplan-wrapper">
          <svg
            id="floorplan"
            viewBox="0 0 800 520"
            role="img"
            aria-labelledby="floorplan-title"
          >
            <title id="floorplan-title">Interaktiver Grundriss</title>
          </svg>
        </div>
        <div class="legend">
          <span class="legend-item">
            <svg class="legend-icon" viewBox="0 0 36 12" aria-hidden="true">
              <line class="legend-wall" x1="4" y1="6" x2="32" y2="6" />
            </svg>
            Wand
          </span>
          <span class="legend-item">
            <svg class="legend-icon" viewBox="0 0 36 24" aria-hidden="true">
              <line class="legend-door-frame" x1="6" y1="6" x2="20" y2="6" />
              <line class="legend-door-leaf" x1="6" y1="6" x2="6" y2="20" />
              <path class="legend-door-arc" d="M 20 6 A 14 14 0 0 1 6 20" />
            </svg>
            Tür
          </span>
          <span class="legend-item">
            <svg class="legend-icon" viewBox="0 0 36 12" aria-hidden="true">
              <line class="legend-window-line" x1="4" y1="4" x2="32" y2="4" />
              <line class="legend-window-line" x1="4" y1="8" x2="32" y2="8" />
              <line class="legend-window-cross" x1="18" y1="4" x2="18" y2="8" />
            </svg>
            Fenster
          </span>
        </div>
        <div class="floorplan-actions">
          <button id="add-comment" class="primary" type="button">
            Kommentar hinzufügen
          </button>
          <button id="clear-selection" type="button">Auswahl löschen</button>
        </div>
      </section>

      <aside class="sidebar" aria-label="Raumdetails">
        <section class="panel view-toggle">
          <div class="panel-header">
            <h3>Ansicht</h3>
          </div>
          <div
            class="segmented-control"
            role="tablist"
            aria-label="Ansicht wählen"
          >
            <button
              class="segmented-option is-active"
              type="button"
              data-app-view="room"
              id="view-room"
            >
              Raum
            </button>
            <button
              class="segmented-option"
              type="button"
              data-app-view="tasks"
              id="view-tasks"
            >
              Aufgaben
            </button>
          </div>
        </section>

        <div class="view-stack is-active" id="room-view">
          <section class="panel" id="room-panel">
            <h2 id="room-title">Bitte wählen Sie einen Raum</h2>
            <p id="room-subtitle">
              Klicken Sie auf einen Raum im Grundriss, um Details zu sehen.
            </p>
            <div class="room-tabs" role="tablist" aria-label="Raumdetails">
              <button
                class="room-tab is-active"
                type="button"
                data-room-tab="overview"
                aria-selected="true"
              >
                Übersicht
              </button>
              <button
                class="room-tab"
                type="button"
                data-room-tab="tasks"
                aria-selected="false"
              >
                Aufgaben
              </button>
              <button
                class="room-tab"
                type="button"
                data-room-tab="inspiration"
                aria-selected="false"
              >
                Inspiration
              </button>
              <button
                class="room-tab"
                type="button"
                data-room-tab="decisions"
                aria-selected="false"
              >
                Entscheidungen
              </button>
            </div>
          </section>

          <section
            class="panel three-d-panel"
            id="three-d-panel"
            data-room-panel="overview"
            hidden
          >
            <div class="panel-header">
              <h3>3D-Ansicht</h3>
              <button id="toggle-3d" type="button">Öffnen</button>
            </div>
            <p id="three-d-label" class="helper">3D-Ansicht für den Raum</p>
            <div class="three-d-controls">
              <div class="three-d-control">
                <span class="three-d-control-label">Ansicht</span>
                <div
                  class="segmented-control"
                  role="group"
                  aria-label="3D-Ansicht wählen"
                >
                  <button
                    class="segmented-option is-active"
                    type="button"
                    data-view="walkthrough"
                  >
                    Innen
                  </button>
                  <button
                    class="segmented-option"
                    type="button"
                    data-view="dollhouse"
                  >
                    Modell
                  </button>
                </div>
              </div>
              <label class="three-d-control">
                <span class="three-d-control-label">Stil</span>
                <select id="three-d-style">
                  <option value="soft-modern">Soft Modern</option>
                  <option value="warm-minimal">Warm Minimal</option>
                  <option value="urban-atelier">Urban Atelier</option>
                  <option value="scandi-light">Scandi Light</option>
                </select>
              </label>
              <label class="three-d-control">
                <span class="three-d-control-label">Material</span>
                <select id="three-d-floor">
                  <option value="oak">Eiche</option>
                  <option value="warm-oak">Räuchereiche</option>
                  <option value="stone">Naturstein</option>
                  <option value="tile">Feinsteinzeug</option>
                  <option value="terrazzo">Terrazzo</option>
                </select>
              </label>
              <label class="three-d-control">
                <span class="three-d-control-label">Licht</span>
                <select id="three-d-lighting">
                  <option value="day">Tageslicht</option>
                  <option value="golden">Goldene Stunde</option>
                  <option value="evening">Abend</option>
                  <option value="studio">Studio</option>
                </select>
              </label>
              <button id="three-d-reset" type="button">
                Ansicht zurücksetzen
              </button>
            </div>
            <div class="three-d-viewer">
              <div
                class="three-d-stage"
                id="three-d-stage"
                data-view="walkthrough"
              >
                <div class="three-d-camera" id="three-d-camera">
                  <div class="three-d-room" id="three-d-room"></div>
                </div>
              </div>
              <div class="three-d-hud">
                <span class="three-d-hint">
                  Ziehen: Blick drehen · Scrollen: Zoom
                </span>
                <span id="three-d-readout" class="three-d-readout"></span>
              </div>
            </div>
          </section>

          <section class="panel" id="room-tasks-panel" data-room-panel="tasks">
            <h3>Aufgaben</h3>
            <ul id="room-tasks" class="task-list"></ul>
            <p id="room-tasks-empty" class="helper" hidden>
              Noch keine Aufgaben für diesen Raum.
            </p>
            <form id="task-form" class="form-row">
              <input
                type="text"
                id="task-input"
                placeholder="Aufgabe hinzufügen, z.B. Fliesen bestellen #material"
              />
              <button type="submit" class="primary">Hinzufügen</button>
            </form>
            <p class="helper">Hashtags werden als Tags übernommen.</p>
          </section>

          <section class="panel" data-room-panel="inspiration">
            <h3>Inspirationen &amp; Referenzen</h3>
            <p class="helper">
              Sammeln Sie Bilder, Links und Dateien als Grundlage für
              Entscheidungen.
            </p>
            <div class="evidence-block">
              <h4>Bilder, Dateien &amp; Links</h4>
              <div id="image-gallery" class="image-gallery"></div>
              <div class="button-row">
                <button id="generate-image" class="primary" type="button">
                  Mit ChatGPT erzeugen
                </button>
                <label class="upload-btn">
                  Datei hochladen
                  <input type="file" id="upload-image" />
                </label>
                <button id="add-evidence-link" type="button">
                  Link hinzufügen
                </button>
                <button id="set-api-key" type="button">
                  API-Schlüssel setzen
                </button>
              </div>
              <p id="image-status" class="helper"></p>
              <p class="helper">
                Tipp: mehrere Blickwinkel pro Raum speichern.
              </p>
            </div>
          </section>

          <section class="panel" data-room-panel="decisions">
            <h3>Entscheidungen</h3>
            <p class="helper">
              Halten Sie fest, was beschlossen wurde und warum. Optional mit
              Aufgaben verknüpfen.
            </p>
            <ul id="decision-list" class="decision-list"></ul>
            <form id="decision-form" class="decision-form">
              <label>
                Titel
                <input
                  type="text"
                  id="decision-title"
                  name="decision-title"
                  required
                />
              </label>
              <label>
                Begründung
                <textarea
                  id="decision-body"
                  name="decision-body"
                  rows="4"
                  required
                ></textarea>
              </label>
              <fieldset class="decision-links">
                <legend>Mit Aufgaben verknüpfen (optional)</legend>
                <div id="decision-tasks" class="decision-task-list"></div>
                <p id="decision-tasks-empty" class="helper"></p>
              </fieldset>
              <button class="primary" type="submit">
                Entscheidung speichern
              </button>
            </form>
          </section>

          <section class="panel" data-room-panel="overview">
            <h3>Kommentare</h3>
            <ul id="comments" class="comments"></ul>
          </section>

          <section class="panel" data-room-panel="overview">
            <h3>Aktivität im Raum</h3>
            <ul id="room-activity" class="activity-list"></ul>
            <p id="room-activity-empty" class="helper"></p>
          </section>
        </div>

        <div class="view-stack" id="tasks-view" hidden>
          <section class="panel" id="tasks-panel">
            <div class="panel-header">
              <div class="panel-title">
                <h2>Aufgabenübersicht</h2>
                <p id="task-count" class="helper">0 Aufgaben</p>
              </div>
              <button id="tasks-reset" type="button">
                Filter zurücksetzen
              </button>
            </div>
            <div class="task-views">
              <span class="task-views-label">Ansichten</span>
              <div
                class="segmented-control"
                role="tablist"
                aria-label="Aufgabenansichten"
              >
                <button
                  class="segmented-option is-active"
                  type="button"
                  data-task-view="all"
                  aria-selected="true"
                >
                  Alle
                </button>
                <button
                  class="segmented-option"
                  type="button"
                  data-task-view="materials"
                  aria-selected="false"
                >
                  Material
                </button>
                <button
                  class="segmented-option"
                  type="button"
                  data-task-view="permits"
                  aria-selected="false"
                >
                  Genehmigungen
                </button>
                <button
                  class="segmented-option"
                  type="button"
                  data-task-view="contractors"
                  aria-selected="false"
                >
                  Handwerker
                </button>
              </div>
            </div>
            <div class="task-filters">
              <label>
                Raum
                <select id="task-filter-room"></select>
              </label>
              <label>
                Status
                <select id="task-filter-status"></select>
              </label>
              <label>
                Zuständig
                <select id="task-filter-assignee"></select>
              </label>
              <label>
                Tag
                <select id="task-filter-tag"></select>
              </label>
              <label>
                Suche
                <input
                  type="search"
                  id="task-filter-search"
                  placeholder="Nach Titel oder Notiz suchen"
                />
              </label>
            </div>
            <div class="task-bulk-actions">
              <label class="task-select-all">
                <input type="checkbox" id="task-select-all" />
                <span>Alle auswählen</span>
              </label>
              <span id="task-selection-count" class="helper"
                >Keine Auswahl</span
              >
              <div class="task-bulk-row">
                <button id="task-bulk-done" type="button" disabled>
                  Erledigt markieren
                </button>
                <div class="task-bulk-field">
                  <select id="task-bulk-assignee"></select>
                  <button id="task-bulk-assign" type="button" disabled>
                    Zuweisen
                  </button>
                </div>
                <div class="task-bulk-field">
                  <input type="date" id="task-bulk-due" />
                  <button id="task-bulk-due-apply" type="button" disabled>
                    Fällig setzen
                  </button>
                </div>
              </div>
            </div>
            <ul id="task-list" class="task-list"></ul>
            <p id="tasks-empty" class="helper" hidden>
              Keine Aufgaben für diese Filter.
            </p>
            <div class="timeline-panel">
              <h3>Timeline</h3>
              <div id="timeline-list" class="timeline-list"></div>
            </div>
          </section>
        </div>
      </aside>
    </main>

    <section class="activity-page" aria-label="Aktivitätsfeed">
      <div class="activity-header">
        <div>
          <h2>Aktivitätsfeed</h2>
          <p class="helper">
            Letzte Ereignisse aus Aufgaben, Kommentaren, Dateien und
            Entscheidungen.
          </p>
        </div>
      </div>
      <ul id="activity-feed" class="activity-list"></ul>
      <p id="activity-empty" class="helper">Noch keine Aktivität vorhanden.</p>
    </section>

    <section id="architect-view" class="architect-view" hidden>
      <h2>Architekt-Ansicht</h2>
      <p>
        Ziehen Sie Räume, Wände, Türen und Fenster direkt im Grundriss.
        Öffnungen rasten an Wänden ein. Klicken Sie ein Element, um Maße
        feinzujustieren.
      </p>

      <div class="architect-panel">
        <h3 id="architect-title">Element wählen</h3>
        <form id="measurement-form" class="measurement-form" hidden>
          <div
            class="measurement-group"
            role="group"
            aria-labelledby="measure-axis-label"
          >
            <span id="measure-axis-label" class="measurement-label">
              X-Position der Wand (mm)
            </span>
            <div class="measurement-row">
              <input
                type="range"
                id="measure-axis"
                min="0"
                max="10000"
                aria-labelledby="measure-axis-label"
              />
              <input
                type="number"
                id="measure-axis-number"
                min="0"
                max="10000"
                step="20"
                required
                aria-labelledby="measure-axis-label"
              />
            </div>
          </div>
          <div
            class="measurement-group"
            role="group"
            aria-labelledby="measure-span-label"
          >
            <span id="measure-span-label" class="measurement-label">
              Y-Länge der Wand (mm)
            </span>
            <div class="measurement-row">
              <input
                type="range"
                id="measure-span"
                min="0"
                max="10000"
                aria-labelledby="measure-span-label"
              />
              <input
                type="number"
                id="measure-span-number"
                min="0"
                max="10000"
                step="20"
                required
                aria-labelledby="measure-span-label"
              />
            </div>
          </div>
          <div
            id="measure-height-row"
            class="measurement-group"
            role="group"
            aria-labelledby="measure-height-label"
          >
            <span id="measure-height-label" class="measurement-label">
              Öffnungshöhe (mm)
            </span>
            <div class="measurement-row">
              <input
                type="range"
                id="measure-height"
                min="0"
                max="3000"
                aria-labelledby="measure-height-label"
              />
              <input
                type="number"
                id="measure-height-number"
                min="0"
                max="3000"
                step="10"
                required
                aria-labelledby="measure-height-label"
              />
            </div>
          </div>
          <label id="measure-swing-row" class="measurement-toggle">
            <input type="checkbox" id="measure-swing" />
            Schwenkbogen anzeigen
          </label>
          <label id="measure-lock-row" class="measurement-toggle">
            <input type="checkbox" id="measure-lock" checked />
            Angrenzende Räume koppeln
          </label>
          <p id="measure-note" class="helper">Wandhöhe fix: 2800 mm.</p>
          <button type="submit" class="visually-hidden">
            Werte übernehmen
          </button>
        </form>
        <p id="architect-help" class="helper"></p>
      </div>
    </section>

    <div id="task-modal" class="modal" hidden>
      <div
        class="modal-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="task-modal-title"
      >
        <div class="modal-header">
          <h3 id="task-modal-title">Aufgabe planen</h3>
          <button type="button" id="task-modal-close">Schließen</button>
        </div>
        <form id="task-modal-form" class="modal-form">
          <label>
            Startdatum
            <input type="date" id="task-start-date" />
          </label>
          <label>
            Enddatum
            <input type="date" id="task-end-date" />
          </label>
          <div class="dependency-panel">
            <div class="dependency-title">Abhängigkeiten</div>
            <div id="task-dependency-list" class="dependency-list"></div>
          </div>
          <div class="modal-actions">
            <button type="button" id="task-modal-cancel">Abbrechen</button>
            <button type="submit" class="primary">Speichern</button>
          </div>
        </form>
      </div>
    </div>

    <div id="image-modal" class="modal" hidden>
      <div
        class="modal-surface image-modal-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="image-modal-title"
      >
        <div class="modal-header">
          <h3 id="image-modal-title">Bild bearbeiten</h3>
          <button type="button" id="image-modal-close">Schließen</button>
        </div>
        <div class="image-modal-body">
          <div class="image-modal-preview">
            <div class="image-preview-frame">
              <img
                id="image-modal-preview"
                alt=""
                src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
              />
              <canvas id="image-mask-canvas" class="image-mask" hidden></canvas>
            </div>
            <div class="image-mask-tools">
              <button type="button" id="image-mask-toggle">
                Bereich markieren
              </button>
              <label class="image-mask-size">
                <span>Pinsel</span>
                <input
                  type="range"
                  id="image-mask-size"
                  min="6"
                  max="80"
                  value="28"
                />
              </label>
              <button type="button" id="image-mask-clear">Maske löschen</button>
            </div>
            <p class="helper image-mask-hint">
              Transparente Bereiche werden verändert.
            </p>
          </div>
          <div class="image-modal-sidebar">
            <div id="image-modal-meta" class="image-modal-meta"></div>
            <form id="image-edit-form" class="image-edit-form">
              <label>
                Neue Anweisung
                <textarea
                  id="image-edit-prompt"
                  rows="3"
                  placeholder="z.B. neue Farben, anderes Licht, Detail ändern"
                ></textarea>
              </label>
              <button type="submit" class="primary">Änderung erzeugen</button>
              <p id="image-edit-status" class="helper"></p>
            </form>
            <div class="image-pin-panel">
              <label>
                Pin an Fläche
                <select id="image-pin-surface">
                  <option value="">Nicht angeheftet</option>
                  <option value="wall-north">Wand Nord</option>
                  <option value="wall-south">Wand Süd</option>
                  <option value="wall-east">Wand Ost</option>
                  <option value="wall-west">Wand West</option>
                  <option value="floor">Boden</option>
                  <option value="ceiling">Decke</option>
                </select>
              </label>
              <div class="image-pin-actions">
                <button type="button" id="image-pin-apply">Anheften</button>
                <button type="button" id="image-pin-clear">Pin lösen</button>
              </div>
            </div>
            <div class="image-thread">
              <h4>Verlauf</h4>
              <ul id="image-thread-list" class="image-thread-list"></ul>
            </div>
            <button type="button" id="image-delete" class="image-delete">
              Bild löschen
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="help-modal" class="modal" hidden>
      <div
        class="modal-surface help-surface"
        role="dialog"
        aria-modal="true"
        aria-labelledby="help-modal-title"
      >
        <div class="modal-header">
          <h3 id="help-modal-title">Hilfe &amp; Schnellstart</h3>
          <button type="button" id="help-modal-close">Schließen</button>
        </div>
        <div class="help-content">
          <p class="helper">
            Kurz erklärt: Die Bereiche aus den letzten Prompts (A-E) in
            Klartext.
          </p>
          <div class="help-grid">
            <section class="help-card">
              <h4>Ansicht &amp; Navigation</h4>
              <p>
                Etage oben rechts wechseln. Im Block "Ansicht" zwischen Raum und
                Aufgabenübersicht umschalten.
              </p>
            </section>
            <section class="help-card">
              <h4>Raumdetails</h4>
              <p>
                Raum im Grundriss anklicken, dann Tabs nutzen: Übersicht
                (Kommentare, Aktivität), Aufgaben (raumbezogen), Inspiration
                (Bilder, Links, Dateien) und Entscheidungen.
              </p>
            </section>
            <section class="help-card">
              <h4>Aufgabenübersicht</h4>
              <p>
                Alle Aufgaben mit Filtern, Suche und Mehrfachauswahl. Bulk:
                Erledigt, Zuweisen, Fällig. Timeline zeigt Termine.
              </p>
            </section>
            <section class="help-card">
              <h4>Inspiration</h4>
              <p>
                Bilder hochladen oder per ChatGPT erzeugen, Links und Dateien
                sammeln, um Referenzen für den Raum zu sichern.
              </p>
            </section>
            <section class="help-card">
              <h4>Entscheidungen</h4>
              <p>
                Beschlüsse dokumentieren, begründen und optional mit Aufgaben
                verknüpfen, damit nachvollziehbar bleibt, warum etwas gewählt
                wurde.
              </p>
            </section>
            <section class="help-card">
              <h4>3D-Ansicht</h4>
              <p>
                Im Raum-Panel öffnen. Innen/Modell wählen, Stil, Material und
                Licht anpassen, Ansicht zurücksetzen.
              </p>
            </section>
            <section class="help-card">
              <h4>Architekt-Ansicht</h4>
              <p>
                Oben aktivieren, Räume/Wände/Türen/Fenster ziehen. Maße rechts
                justieren, "Angrenzende Räume koppeln" hält Nachbarn synchron.
              </p>
            </section>
            <section class="help-card">
              <h4>Aktivität</h4>
              <p>
                Der Aktivitätsfeed unten bündelt neue Aufgaben, Kommentare,
                Dateien und Entscheidungen.
              </p>
            </section>
          </div>
        </div>
      </div>
    </div>

    <footer class="app-footer">
      <p>Große Schaltflächen, klare Sprache und ein Raum nach dem anderen.</p>
    </footer>

    <script src="config.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
